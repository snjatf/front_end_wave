<html>
    <meta charset="utf-8">
    <head>
    <script src="lib/reactjs/react.min.js"></script>
    <script src="lib/reactjs/react-dom.min.js"></script>
    <script src="lib/reactjs/browser.min.js"></script>
    <script src="lib/jquery/jquery.min.js"></script>
    <script src="lib/Common/marked.min.js"></script>
    </head>
    <body>
    <div id="content"></div>
    <script type="text/babel">
  // var CommentBox=React.createClass({displayName:'CommentBox',
  //     render:function(){
  //     return (
  //       React.createElement('div',{className:"commentBox"},
  //       "Hello, world! I am a CommentBox."
  //       )
  //     );
  //     }
  //     });
  //     ReactDOM.render(
  //       React.createElement(CommentBox,null),
  //       document.getElementById('content')
  //     );



  var CommentForm = React.createClass({
    handleSubmit: function(e) {
      e.preventDefault();
      var author = this.refs.author.value.trim();
      var text = this.refs.text.value.trim();
      if (!text || !author) {
        return;
      }
      // TODO: send request to the server
      this.refs.author.value = '';
      this.refs.text.value = '';
      return;
  },
  render: function() {
    return (
      <form className="commentForm" onSubmit={this.handleSubmit}>
        <input type="text" placeholder="Your name" ref="author" />
        <input type="text" placeholder="Say something..." ref="text" />
        <input type="submit" value="Post" />
      </form>
    );
  }
  });

  var CommentBox =React.createClass({
    getInitialState:function(){
      return {data:[]};
    },
    loadCommentsFromServer:function(){
      $.ajax(
        url: this.props.url,
        dataType:'json',
        cache:'false',
        success:function(){
          this.setState({data:data});
        }.bind(this),
        error:function() {
          console.error(this.props.url,err.toString());
        }.bind(this)
      );
    },
    componentDidMount: function() {
      this.loadCommentsFromServer();
      setInterval(this.loadCommentsFromServer, this.props.pollInterval);
    },
    render:function(){
      return (
        <div className="commentBox">
         <h1>Comments</h1>
         <CommentList data={this.state.data}/>
         <CommentForm />
        </div>
         );
    }
  });

  var Comment=React.createClass({
    rawMarkup: function() {
    var rawMarkup = marked(this.props.children.toString(), {sanitize: true});
    return { __html: rawMarkup };
  },
    render:function(){
    return (
      <div className="comment">
              <h2 className="commentAuthor">
                {this.props.author}
              </h2>
                <span dangerouslySetInnerHTML={this.rawMarkup()} />
            </div>
    );
    }
  });

  var CommentList = React.createClass({
    render: function() {
      var commentNodes = this.props.data.map(function (comment) {
      return (
        <Comment author={comment.author}>
          {comment.text}
        </Comment>
      );
    });
    return (
      <div className="commentList">
        {commentNodes}
      </div>
    );
  }
  });

  var data = [
  {author: "Pete Hunt", text: "This is one comment [百度一下](http://www.baidu.com)"},
  {author: "Jordan Walke", text: "This is *another* comment"}
  ];
  ReactDOM.render(
    <CommentBox url="/services/db.json" pollInterval={2000}/>,
    document.getElementById('content')
  );
    </script>
    </body>
</html>
